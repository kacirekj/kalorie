<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.1.6/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.16.4/lodash.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="vue-googlemaps.css">

    <script src="vue-google-maps.js"></script>
</head>
<body>

<div id="app">
    <gmap-map style="width: 80%; height: 100%; position: absolute; left:0; top:0" :center="center" :zoom="zoom"
              @rightclick="onMapRightClick">
        <gmap-marker v-for="marker in markers" v-bind:key="marker.id" :position="{lat: marker.lat, lng: marker.lng}"
                     @click="onMarkerClick(marker)"></gmap-marker>
    </gmap-map>
</div>

<script>

    Vue.use(VueGoogleMaps, {
        load: {
            // Google API key
            key: 'AIzaSyCca3BtctZGXkMlZSk8hNXXw_j_EMYLDBI',
            // Enable more Google Maps libraries here
            libraries: ['places'],
            // Use new renderer
            useBetaRenderer: false,
        },
    })

    // VueGoogleMap.load({
    //     'key': 'AIzaSyCca3BtctZGXkMlZSk8hNXXw_j_EMYLDBI',
    // })
    // Vue.component('google-map', VueGoogleMap.Map);
    // Vue.component('google-map-marker', VueGoogleMap.Marker);
    new Vue({
        el: '#app',
        data: {
            center: {
                lat: 1.38,
                lng: 103.8
            },
            zoom: 12,
            markers: [
            ]
        },
        methods: {
            createMarker: function (lat, lng, note) {
                let id = Date.now();
                return {id, lat, lng, note}
            },
            onMapRightClick: function (input) {
                let newMarker = this.createMarker(input.latLng.lat(), input.latLng.lng(), 'Hello!');
                this.markers.push(newMarker);
                axios.post('marker', newMarker);
            },
            onMarkerClick: function (input) {
                this.markers.splice(this.markers.indexOf(input), 1)
                axios.delete('marker/' + input.id);
            },
        },
        mounted() {
            console.log("Mounted!");
                axios.get('marker/all')
                    .then((response) => {
                        console.log(response.data)
                        this.markers.push(...response.data)
                    });

        },
        // mounted: function () {
        //     console.log('here')
        //     this.zoom = 100
        // }
    });

</script>

</body>
